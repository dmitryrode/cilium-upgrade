# Full dataset: Replace this with your full input
data = {
    "00 01 56 00 6e 00 00 00": {    
        "CPU 00": "cd d9 27 00 00 00 00 00  f5 bc b7 13 01 00 00 00",
        "CPU 01": "5f d5 13 00 00 00 00 00  d9 26 90 63 00 00 00 00",
        "CPU 02": "13 4e 1a 00 00 00 00 00  71 e7 9b c1 00 00 00 00",
        "CPU 03": "8f b4 3b 00 00 00 00 00  b5 21 ec ee 00 00 00 00",
        },
    "c4 01 00 00 00 00 00 00": {
        "CPU 00": "00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00",
        "CPU 01": "00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00",
        "CPU 02": "a8 00 00 00 00 00 00 00  c8 70 00 00 00 00 00 00",
        "CPU 03": "00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00",
        },

    "8b 02 d7 05 02 00 00 00": {
        "CPU 00": "2b 00 00 00 00 00 00 00  c2 0b 00 00 00 00 00 00",
        "CPU 01": "58 00 00 00 00 00 00 00  10 18 00 00 00 00 00 00",
        "CPU 02": "82 00 00 00 00 00 00 00  8c 23 00 00 00 00 00 00",
        "CPU 03": "83 00 00 00 00 00 00 00  d2 23 00 00 00 00 00 00",
        },

    "00 02 35 00 70 00 00 00": {
        "CPU 00": "86 b1 f2 00 00 00 00 00  f1 d8 28 cc 0d 00 00 00",
        "CPU 01": "fb 2d 02 01 00 00 00 00  18 a7 38 cc 0f 00 00 00",
        "CPU 02": "9e b4 ee 00 00 00 00 00  b9 b4 62 d8 0c 00 00 00",
        "CPU 03": "e7 04 ed 00 00 00 00 00  46 8a e6 6e 0d 00 00 00",
        },
    "00 02 eb 00 6f 00 00 00": {
        "CPU 00": "d0 d5 18 01 00 00 00 00  03 8a 37 ec 0d 00 00 00",
        "CPU 01": "3b c2 22 01 00 00 00 00  9f dc 59 ea 0f 00 00 00",
        "CPU 02": "dd be 13 01 00 00 00 00  05 73 43 f6 0c 00 00 00",
        "CPU 03": "2b fe 21 01 00 00 00 00  72 3a 3f 92 0d 00 00 00",
        },
    "00 01 00 00 00 00 00 00": {
        "CPU 00": "4a 72 a2 03 00 00 00 00  1d bf 0f 12 0b 00 00 00",
        "CPU 01": "8c c5 3c 05 00 00 00 00  a9 b2 fd eb 09 00 00 00",
        "CPU 02": "98 64 a2 04 00 00 00 00  d4 41 6e 93 0b 00 00 00",
        "CPU 03": "a0 19 c2 03 00 00 00 00  13 b4 bd a2 0a 00 00 00",
        },
    "03 01 a8 02 03 00 00 00": {
        "CPU 00": "a6 4d c6 00 00 00 00 00  27 14 df 00 01 00 00 00",
        "CPU 01": "dd 8a 32 01 00 00 00 00  9b cc 43 fb 00 00 00 00",
        "CPU 02": "21 6d c7 00 00 00 00 00  a3 05 76 bc 00 00 00 00",
        "CPU 03": "d0 da b2 00 00 00 00 00  01 0c 80 a6 00 00 00 00",
        },
    "a8 02 00 00 00 00 00 00": {
        "CPU 00": "00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00",
        "CPU 01": "01 00 00 00 00 00 00 00  5e 00 00 00 00 00 00 00",
        "CPU 02": "02 00 00 00 00 00 00 00  bc 00 00 00 00 00 00 00",
        "CPU 03": "02 00 00 00 00 00 00 00  bc 00 00 00 00 00 00 00",
    },
    "00 02 c8 06 01 00 00 00": {
        "CPU 00": "99 e7 00 00 00 00 00 00  a5 f2 46 00 00 00 00 00",
        "CPU 01": "5c 4a 01 00 00 00 00 00  a5 98 63 00 00 00 00 00",
        "CPU 02": "bc 19 01 00 00 00 00 00  2c 3c 55 00 00 00 00 00",
        "CPU 03": "47 f0 00 00 00 00 00 00  67 75 46 00 00 00 00 00",
    },
    "03 01 7c 04 01 00 00 00": {
        "CPU 00": "fe 94 17 01 00 00 00 00  41 82 32 49 03 00 00 00",
        "CPU 01": "ea 8d 5f 01 00 00 00 00  d8 2b ce f5 01 00 00 00",
        "CPU 02": "a4 27 01 01 00 00 00 00  09 24 1e 61 02 00 00 00",
        "CPU 03": "42 4e 30 01 00 00 00 00  f3 46 a8 a2 02 00 00 00",
    },
    "00 02 00 00 00 00 00 00": {
        "CPU 00": "3e 35 3a 0b 00 00 00 00  ef 0c 34 fa 95 00 00 00",
        "CPU 01": "de 49 27 0c 00 00 00 00  59 9d a8 a3 b0 00 00 00",
        "CPU 02": "ff 44 c0 0b 00 00 00 00  5a 40 1c 84 92 00 00 00",
        "CPU 03": "ee 51 6c 0b 00 00 00 00  df 7b 11 7c 97 00 00 00",
    },
    "00 02 1f 05 02 00 00 00": {
        "CPU 00": "09 fa 23 00 00 00 00 00  ec a6 81 0f 00 00 00 00",
        "CPU 01": "63 fc 1c 00 00 00 00 00  d9 f8 c8 0d 00 00 00 00",
        "CPU 02": "32 ad 20 00 00 00 00 00  73 54 9e 0e 00 00 00 00",
        "CPU 03": "78 02 31 00 00 00 00 00  d8 93 f4 12 00 00 00 00",
    },
    "00 02 56 00 6e 00 00 00": {
        "CPU 00": "bb 93 0f 00 00 00 00 00  93 fc da c9 00 00 00 00",
        "CPU 01": "99 3b 0f 00 00 00 00 00  e5 b8 e0 c9 00 00 00 00",
        "CPU 02": "41 c9 0e 00 00 00 00 00  c9 ee d6 bf 00 00 00 00",
        "CPU 03": "2d a4 0e 00 00 00 00 00  b9 62 9e bb 00 00 00 00",
    },
    "8b 02 00 00 00 00 00 00": {
        "CPU 00": "ae 00 00 00 00 00 00 00  e0 2f 00 00 00 00 00 00",
        "CPU 01": "59 01 00 00 00 00 00 00  de 5e 00 00 00 00 00 00",
        "CPU 02": "0d 02 00 00 00 00 00 00  5e 90 00 00 00 00 00 00",
        "CPU 03": "07 02 00 00 00 00 00 00  96 8e 00 00 00 00 00 00",
    },
    "00 02 4e 06 01 00 00 00": {
        "CPU 00": "b7 b6 f2 00 00 00 00 00  1f 8d aa fb 0d 00 00 00",
        "CPU 01": "99 33 02 01 00 00 00 00  c0 ec c1 fe 0f 00 00 00",
        "CPU 02": "77 c4 ee 00 00 00 00 00  2c 80 23 07 0d 00 00 00",
        "CPU 03": "0e 09 ed 00 00 00 00 00  02 fe 36 9d 0d 00 00 00",
    },
    "03 01 00 00 00 00 00 00": {
        "CPU 00": "9d 3d 01 06 00 00 00 00  46 7d 21 c2 0b 00 00 00",
        "CPU 01": "c5 e2 6c 09 00 00 00 00  66 10 e2 79 0b 00 00 00",
        "CPU 02": "9d ed c9 07 00 00 00 00  24 73 fd 65 0c 00 00 00",
        "CPU 03": "3d 46 1b 06 00 00 00 00  b0 55 a6 b6 0a 00 00 00",
    },
    "00 01 eb 00 6f 00 00 00": {
        "CPU 00": "bd d7 fc 00 00 00 00 00  1d fd 15 de 02 00 00 00",
        "CPU 01": "de 5a 54 01 00 00 00 00  7e a2 4d 28 02 00 00 00",
        "CPU 02": "69 6f ef 00 00 00 00 00  40 7c 8d 3d 02 00 00 00",
        "CPU 03": "0b 53 fc 00 00 00 00 00  4f c6 b7 50 02 00 00 00",
    },
    # Add the rest of your data here
}

def little_endian_to_decimal(hex_str):
    """Convert little-endian hex string to two decimal values."""
    parts = hex_str.split()
    first_64_bits = parts[:8]
    second_64_bits = parts[8:]

    first_value = int(''.join(reversed(first_64_bits)), 16)
    second_value = int(''.join(reversed(second_64_bits)), 16)

    return first_value, second_value

def analyze_dropped_packets(data, drop_threshold=0.1):
    """
    Analyze the dataset for dropped packets and high drop ratios.
    
    Args:
        data: Nested dictionary with keys and CPU data.
        drop_threshold: Minimum packet ratio (min/max) to flag high drop ratios.
    
    Returns:
        List of detected anomalies.
    """
    anomalies = []
    for key, cpu_data in data.items():
        print(f"\nKey: {key}")
        cpu_metrics = {}
        for cpu, hex_str in cpu_data.items():
            packets, bytes_count = little_endian_to_decimal(hex_str)
            cpu_metrics[cpu] = {"packets": packets, "bytes": bytes_count}
            print(f"  {cpu}: Packets={packets}, Bytes={bytes_count}")
        
        # Extract metrics for analysis
        packet_values = [metrics["packets"] for metrics in cpu_metrics.values()]
        byte_values = [metrics["bytes"] for metrics in cpu_metrics.values()]

        # Calculate total packets/bytes
        total_packets = sum(packet_values)
        total_bytes = sum(byte_values)

        # Identify anomalies
        if all(p == 0 for p in packet_values):
            anomalies.append(f"Key {key}: All CPUs have zero packets.")
        elif max(packet_values) > 0 and min(packet_values) / max(packet_values) < drop_threshold:
            anomalies.append(f"Key {key}: High drop ratio detected (Packets).")
        if all(b == 0 for b in byte_values):
            anomalies.append(f"Key {key}: All CPUs have zero bytes.")
        elif max(byte_values) > 0 and min(byte_values) / max(byte_values) < drop_threshold:
            anomalies.append(f"Key {key}: High drop ratio detected (Bytes).")
        
        # Add summary for total counts
        print(f"  Total Packets: {total_packets}, Total Bytes: {total_bytes}")

    return anomalies

# Run the analysis with a drop threshold of 10%
drop_threshold = 0.1  # Adjust threshold as needed (e.g., 0.2 for 20%)
anomalies = analyze_dropped_packets(data, drop_threshold=drop_threshold)

# Print detected anomalies
if anomalies:
    print("\nDetected Anomalies:")
    for anomaly in anomalies:
        print(f"- {anomaly}")
else:
    print("\nNo anomalies detected.")
